<style>

    :root{
      --bg:#FFF8F0;
      --card:#FFFFFF;
      --text:#1F2D3D;
      --muted:#6B7280;
      --line:#F4D2D2;
      --brand:#FF7EB6;
      --brand-2:#64C2FF;
      --ok:#35B36B;
      --warn:#F6B01A;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Arial,sans-serif;margin:0;padding:24px;background:linear-gradient(180deg,#FFF8F0 0%, #FFEFF7 100%);color:var(--text)}
    h1{font-size:22px;margin:0 0 16px}
    h2{font-size:16px;margin:24px 0 8px}
    .card{background:var(--card);border:2px solid var(--line);border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 6px 20px rgba(255,126,182,.15)}
    label{display:block;margin:8px 0 4px;font-size:12px;color:var(--muted)}
    input,select,button,textarea{background:#fff;color:var(--text);border:2px solid var(--line);border-radius:12px;padding:10px 12px;font-size:14px}
    input[type="color"]{padding:0;height:40px;width:60px;border-radius:10px}
    button{cursor:pointer;background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#fff;border:none}
    button.ghost{background:#fff;color:var(--text);border:2px dashed var(--line)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:260px}
    .imgwall{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
    .imgwall figure{margin:0;background:#fff;border:2px solid var(--line);border-radius:12px;overflow:hidden}
    .imgwall img{display:block;width:100%;height:auto}
    .badge{display:inline-block;background:var(--brand-2);border:2px solid var(--line);border-radius:999px;padding:2px 10px;font-size:12px;margin-left:6px;color:#053B5C}
    .small{font-size:12px;color:var(--muted)}
    .tip{background:#FFF2F8;border:2px solid #FFD5E8;border-radius:12px;padding:10px;color:#7A294A}
    .ok{color:var(--ok)} .warn{color:var(--warn)}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .toolbar .chip{background:#FFF2F8;border:2px solid #FFD5E8;border-radius:999px;padding:4px 10px;font-size:12px;color:#7A294A}
    .kbd{display:inline-block;border:2px solid var(--line);border-bottom-width:4px;border-radius:8px;padding:0 6px;background:#fff;font-weight:700}
    canvas{max-width:100%;border:2px dashed var(--line);border-radius:12px;background:#fff}

    /* palette cards */
    .palgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin:6px 0 10px}
    .palcard{border:2px solid var(--line);border-radius:12px;overflow:hidden;background:#fff;cursor:pointer;transition:.15s box-shadow,.15s transform}
    .palcard:hover{box-shadow:0 6px 16px rgba(100,194,255,.25);transform:translateY(-1px)}
    .palcard.selected{outline:3px solid var(--brand-2)}
    .palcard .name{padding:8px 10px;font-size:12px;color:var(--muted);border-top:2px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .swrow{display:flex;height:38px}
    .sw{flex:1}
    .sw label{display:block;font-size:10px;margin:0;padding:4px 6px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.25)}
    .btnline{display:flex;gap:8px;align-items:center;margin:6px 0}

    /* segmented tabs */
    .segline{display:inline-flex;border:2px solid var(--line);border-radius:999px;overflow:hidden}
    .seg{background:#fff;color:var(--text);border:0;padding:8px 12px}
    .seg.active{background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#fff}
  

</style>

<h1>舊屋換新風格（照片上傳版）<span class="badge" id="status">待上傳</span></h1><div class="card">
<h2>1) 上傳原圖 → 自動偵測（結構＋深度）</h2>
<div class="row">
<div class="col">
<label>原始室內照片</label>
<input accept="image/*" id="fileInput" type="file"/>
<p class="small">上傳限制：原始照片 <b>2MB 以內</b>（若過大請先壓縮）</p>
<button id="btnAnalyze">送出 /analyze</button>
<p class="small">支援 JPG / PNG，較大圖會自動等比處理。</p>
</div>
<div class="col">
<label>jobId</label><input id="jobId" placeholder="尚未產生" readonly=""/>
</div>
</div>
</div><div class="card">
<h2>2) 遮罩人工修正（務必鎖住結構，只放開表面可改區）</h2>
<div class="row">
<div class="col">
<div class="tip">
<b>如何畫？</b><br/>
          • <span class="ok">可改</span>：牆面塗料/飾板、天花、地坪、燈具、<b>可移動家具</b>（櫃、沙發、桌椅、床、窗簾等）。<br/>
          • <span class="warn">必鎖</span>：<b>樑、柱、牆體、門窗</b>（含窗框）、固定中島、樓梯、結構開口位置與尺寸。<br/>
          • 建議：邊緣留 3–5px 緩衝避免滲色；先大筆刷勾輪廓，再小筆修邊。<br/>
          • 快捷鍵：<span class="kbd">E</span> 可改、<span class="kbd">R</span> 鎖定、<span class="kbd">Z</span> 復原、<span class="kbd">Y</span> 重做。<br/>
          • 送出前請放大檢查牆角、門框四邊、窗台、樑柱交界是否鎖好。
        </div>
<div class="toolbar" style="margin-top:8px">
<span class="chip">筆刷半徑：<span id="brushVal">20</span>px</span>
<input id="brush" max="80" min="6" style="width:180px" type="range" value="20"/>
<button class="ghost" data-tool="unlock">可改區域（E）</button>
<button class="ghost" data-tool="lock">鎖定區域（R）</button>
<button class="ghost" id="btnUndo">復原（Z）</button>
<button class="ghost" id="btnRedo">重做（Y）</button>
<button id="btnSaveMask">上傳修正遮罩 /masks/save</button>
</div>
</div>
<div class="col">
<div class="toolbar" style="margin:8px 0">
<button class="ghost" id="btnZoomOut">縮小 -</button>
<button class="ghost" id="btnZoomIn">放大 +</button>
<button class="ghost" id="btnZoomReset">重置視圖</button>
<span class="chip">遮罩顯示透明度：<span id="opVal">35</span>%</span>
<input id="overlayOpacity" max="90" min="0" style="width:140px" type="range" value="35"/>
<button class="ghost" id="btnToggleEdges">顯示/隱藏邊緣</button>
<span class="chip">邊緣門檻：<span id="thrVal">60</span></span>
<input id="edgeThr" max="140" min="20" style="width:140px" type="range" value="60"/>
<span class="chip">保護半徑：<span id="radVal">3</span>px</span>
<input id="edgeRad" max="6" min="1" style="width:140px" type="range" value="3"/>
<button class="ghost" id="btnProtectEdges">一鍵保護邊緣</button>
<button class="ghost" id="btnCleanSpecks">自動清理小雜點</button>
<button class="ghost" id="btnSmartFix">邊緣智慧修補</button>
</div>
<div id="canvasWrap" style="position:relative; width:100%; max-width:100%; border-radius:12px; overflow:hidden; border:2px dashed var(--line); background:#fff">
<canvas height="0" id="maskCanvas" width="0"></canvas>
<canvas height="0" id="uiCanvas" style="position:absolute; left:0; top:0; pointer-events:none" width="0"></canvas>
</div>
<p class="small">提示：滑鼠滾輪可縮放；按住 <span class="kbd">Space</span> 拖曳可平移。綠色筆＝<b>可改</b>（擦成透明），紅色筆＝<b>鎖定</b>（補回白）。</p>
</div>
</div>
</div><div class="card">
<h2>3) 選 1–3 風格（同色系）→ 批次生成（預覽含 LOGO）</h2>
<div class="row">
<div class="col">
<label>可選風格（最多 3）</label>
<select id="styleSelect" multiple="" size="6"></select>
</div>
<div class="col">
<label>色系來源</label>
<div class="segline" style="margin-bottom:8px">
<button class="seg active" id="tabPreset">色卡</button>
<button class="seg" id="tabCustom">自訂</button>
</div>
<div id="palettePreset">
<div class="btnline">
<button class="ghost" id="btnRandPal">隨機推薦一組</button>
<span class="small">點一下色卡即可套用；如果要手動微調，請切換到「自訂」。</span>
</div>
<div class="palgrid" id="paletteGrid"></div>
</div>
<div id="paletteCustom" style="display:none">
<div class="row">
<div><span class="small">主色</span><br/><input id="cMain" type="color" value="#1E3A8A"/></div>
<div><span class="small">配1</span><br/><input id="c1" type="color" value="#D4AF37"/></div>
<div><span class="small">配2</span><br/><input id="c2" type="color" value="#ECECEC"/></div>
<div><span class="small">配3</span><br/><input id="c3" type="color" value="#7C8798"/></div>
</div>
</div>
<div class="row" style="margin-top:8px">
<div class="col"><label>LOGO 位置</label>
<select id="logoPos"><option>bottom-right</option><option>bottom-left</option><option>top-right</option><option>top-left</option><option>center</option></select>
</div>
<div class="col"><label>比例</label><input id="logoScale" step="0.01" type="number" value="0.18"/></div>
<div class="col"><label>不透明度</label><input id="logoOpacity" step="0.05" type="number" value="0.9"/></div>
</div>
<button id="btnBatch" style="margin-top:8px">產生 /render/batch</button>
<p class="small">LOGO 檔案固定讀取 <code>static/logo/LOGO.png</code>（後端設定）。</p>
</div>
</div>
</div><div class="card">
<h2>4) 多風格對比牆</h2>
<div class="imgwall" id="wall"></div>
</div><div class="card">
<h2>5) 家具編修（替換／改色 → 最終圖）</h2>
<div class="row">
<div class="col">
<label>基底圖（輸入 style 名稱，對應 previews_clean/<style></style></label></div></div></div>